{% extends 'base.html' %}
{% block title %}{{ 'Edit' if edit else 'Tambah' }} Surat Keramaian{% endblock %}
{% block content %}

<div class="page-title">
  <div class="title_left">
    <h3><i class="fa fa-users"></i> {{ 'Edit' if edit else 'Tambah' }} Surat Keramaian</h3>
  </div>
</div>
<div class="clearfix"></div>

<div class="row">
  <div class="col-md-8 col-sm-12 col-xs-12">
    <div class="x_panel">

      <div class="x_title">
        <h2><i class="fa fa-edit"></i> Form Surat Keramaian</h2>
        <div class="clearfix"></div>
      </div>

      <div class="x_content">
        <form method="POST" class="form-horizontal">

          <!-- Cari NIK -->
          <div class="form-group">
            <label class="control-label col-md-3">Cari NIK/Nama</label>
            <div class="col-md-9">
              <input type="text" id="cari_nik" class="form-control" placeholder="Ketik NIK atau Nama...">
            </div>
          </div>

          <!-- NIK (hidden field, tetap disimpan di DB tapi tidak tampil di cetak) -->
          <input type="hidden" name="nik" id="nik" value="{{ data.nik if data else '' }}">

          <!-- Nama -->
          <div class="form-group">
            <label class="control-label col-md-3">Nama</label>
            <div class="col-md-9">
              <input type="text" name="nama" id="nama" class="form-control" required
                     value="{{ data.nama if data else '' }}">
            </div>
          </div>

          <!-- Umur -->
          <div class="form-group">
            <label class="control-label col-md-3">Umur</label>
            <div class="col-md-9">
              <input type="number" name="umur" id="umur" class="form-control" required
                     value="{{ data.umur if data else '' }}">
            </div>
          </div>

          <!-- Pekerjaan -->
          <div class="form-group">
            <label class="control-label col-md-3">Pekerjaan</label>
            <div class="col-md-9">
              <input type="text" name="pekerjaan" id="pekerjaan" class="form-control"
                     value="{{ data.pekerjaan if data else '' }}">
            </div>
          </div>

          <!-- Alamat -->
          <div class="form-group">
            <label class="control-label col-md-3">Alamat</label>
            <div class="col-md-9">
              <textarea name="alamat" id="alamat" class="form-control" rows="2">{{ data.alamat if data else '' }}</textarea>
            </div>
          </div>

          <!-- Kegiatan -->
          <div class="form-group">
            <label class="control-label col-md-3">Kegiatan</label>
            <div class="col-md-9">
              <input type="text" name="kegiatan" id="kegiatan" class="form-control" required
                     value="{{ data.kegiatan if data else '' }}">
            </div>
          </div>

          <!-- Tanggal Acara -->
          <div class="form-group">
            <label class="control-label col-md-3">Tanggal Acara</label>
            <div class="col-md-9">
              <input type="date" name="tanggal_acara" id="tanggal_acara" class="form-control" required
                     value="{{ data.tanggal_acara if data else '' }}">
            </div>
          </div>

          <!-- Tempat -->
          <div class="form-group">
            <label class="control-label col-md-3">Tempat</label>
            <div class="col-md-9">
              <input type="text" name="tempat" id="tempat" class="form-control" required
                     value="{{ data.tempat if data else '' }}">
            </div>
          </div>

          <!-- Dusun -->
          <div class="form-group">
            <label class="control-label col-md-3">Dusun</label>
            <div class="col-md-9">
              <input type="text" name="dusun" id="dusun" class="form-control"
                     value="{{ data.dusun if data else '' }}">
            </div>
          </div>

          <!-- Tombol -->
          <div class="ln_solid"></div>
          <div class="form-group">
            <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
              <a href="{{ url_for('keramaian.admin_index') }}" class="btn btn-default">Kembali</a>
              <button type="submit" class="btn btn-success">Simpan</button>
            </div>
          </div>

        </form>
      </div>

    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
  $(document).ready(function () {
    $("#cari_nik").autocomplete({
      source: "/keramaian/cari-nik",
      minLength: 2,
      select: function (event, ui) {
        const selected = ui.item.value;
        const nik = selected.split(' - ')[0];
        $("#nik").val(nik);
        getPenduduk(nik);
      }
    });

    function getPenduduk(nik) {
      $.getJSON("/keramaian/penduduk/" + nik, function (data) {
        $("#nama").val(data.nama);
        $("#umur").val(data.umur);
        $("#pekerjaan").val(data.pekerjaan);
        $("#alamat").val(data.alamat);
      });
    }
  });
</script>
{% endblock %}
